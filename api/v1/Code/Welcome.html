<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./assets/css/Main.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Eridian</title>
  </head>

  <body>
    <h6>WELCOME TO</h6>
    <div id="box">
      <h5>ERIDIAN ESPORTS</h5>
      <p>Everything else is just Gaming!!!</p>
      <div class="text">
        <span>Find or Create your own team and play with your friends</span>
        <span
          >Create and Join multiple events and face off against other
          competitive players</span
        >
        <span
          >Play for the picks and be the best competitive player on esports
          history</span
        >
      </div>
      <div style="margin-top: 10rem"></div>
      <!--Buttons-->
      <div class="layout1">
        <a href="#" class="log" data-toggle="modal" data-target="#loginModel"
          ><span id="set" style="text-align: center">LOGIN</span></a
        >
        <a href="#" class="log" data-toggle="modal" data-target="#signupModel"
          ><span id="set" style="text-align: center">SIGNUP</span></a
        >
      </div>

      <div style="text-align: center; margin-top: 5rem">
        <h2 id="discord">JOIN DISCORD FOR A BETTER EXPERIENCE</h2>
      </div>

      <!-- Login Model -->
      <!-- Modal -->
      <div
        class="modal"
        id="loginModel"
        tabindex="-1"
        aria-labelledby="loginModelLabel"
        aria-hidden="true"
      >
        <div
          class="mx-auto modal-dialog-centered"
          style="
            height: 90vh !important;
            width: 90vw !important;
            margin-top: 3vh !important;
          "
        >
          <div
            class="modal-content"
            style="height: 100% !important; width: 100% !important"
          >
            <!-- Modal Body Starts here -->
            <div
              class="modal-body bg-secondary"
              style="height: 100% !important; width: 100% !important"
            >
              <div
                class="container-fluid"
                style="height: 100% !important; width: 100% !important"
              >
                <form
                  id="login_form"
                  method="POST"
                  class="d-flex flex-column justify-content-around mt-3"
                  style="height: 100% !important; width: 100% !important"
                >
                  <h4 class="modal-title" id="loginModelLabel">ERIDIAN</h4>
                  <h4 id="loginMode">ESPORTS</h4>
                  <div
                    class="d-flex flex-column h-25 justify-content-around w-50 mx-auto"
                  >
                    <input
                      id="email"
                      name="email"
                      type="email"
                      class="form-control mt-3"
                      placeholder="youremail@gmail.com"
                    />
                    <input
                      id="loginpassword"
                      name="password"
                      type="password"
                      class="form-control mt-3"
                      placeholder="Your Password"
                    />
                  </div>
                  <div class="d-flex flex-row justify-content-center">
                    <button
                      id="login-submit"
                      type="submit"
                      class="btn buttonnew"
                    >
                      Login
                    </button>
                  </div>
                </form>
              </div>
            </div>
            <!-- Modal body ends here -->
          </div>
        </div>
      </div>

      <!-- SignUp Model -->
      <!-- Modal -->
      <div
        class="modal"
        id="signupModel"
        tabindex="-2"
        aria-labelledby="signupModelLabel"
        aria-hidden="true"
      >
        <div
          class="mx-auto modal-dialog-centered"
          style="
            height: 90vh !important;
            width: 90vw !important;
            margin-top: 3vh !important;
          "
        >
          <div
            class="modal-content"
            style="height: 100% !important; width: 100% !important"
          >
            <!-- Modal Body Starts here -->
            <div
              class="modal-body bg-secondary"
              style="height: 100% !important; width: 100% !important"
            >
              <div
                class="container-fluid"
                style="height: 100% !important; width: 100% !important"
              >
                <form
                  id="signup_form"
                  class="d-flex flex-column justify-content-around mt-3"
                  style="height: 100% !important; width: 100% !important"
                >
                  <h4 class="modal-title" id="loginModelLabel">ERIDIAN</h4>
                  <h4 id="loginMode">ESPORTS</h4>
                  <div
                    class="d-flex flex-column h-25 justify-content-around w-50 mx-auto"
                  >
                    <input
                      id="usertag"
                      name="usertag"
                      type="text"
                      class="form-control mt-3"
                      placeholder="username"
                    />
                    <input
                      id="signup_email"
                      name="email"
                      type="email"
                      class="form-control mt-3"
                      placeholder="youremail@somehting.com"
                    />
                    <input
                      id="signup_password"
                      name="password"
                      type="password"
                      class="form-control mt-3"
                      placeholder="Your Password"
                    />
                    <input
                      id="confirmpassword"
                      name="confirmpassword"
                      type="password"
                      class="form-control mt-3"
                      placeholder="Confirm Password"
                    />
                  </div>
                  <div class="d-flex flex-row justify-content-center">
                    <button
                      id="signin-submit"
                      type="submit"
                      class="btn buttonnew"
                    >
                      Signup
                    </button>
                  </div>
                </form>
              </div>
            </div>
            <!-- Modal body ends here -->
          </div>
        </div>
      </div>
    </div>
    <!-- jQuery and JS bundle w/ Popper.js -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
      crossorigin="anonymous"
    ></script>

    <script>
      $(document).ready(function () {
        // function to make form values to json format
        $.fn.serializeObject = function () {
          var o = {};
          var a = this.serializeArray();
          $.each(a, function () {
            if (o[this.name] !== undefined) {
              if (!o[this.name].push) {
                o[this.name] = [o[this.name]];
              }
              o[this.name].push(this.value || "");
            } else {
              o[this.name] = this.value || "";
            }
          });
          return o;
        };
        // trigger when login form is submitted
        $("#login_form").submit(function (e) {
          e.preventDefault();

          // get form data
          var login_form = $(this);
          var form_data = JSON.stringify(login_form.serializeObject());

          // submit form data to api
          $.ajax({
            url: "../login.php",
            type: "POST",
            contentType: "application/json",
            data: form_data,
            success: function (result) {
              // console.log(result);
              // alert("Login Successful");
              localStorage.setItem("token", result.jwt);
              localStorage.setItem("role", result.role);
              localStorage.setItem("team", result.team);
              localStorage.setItem("teamname", result.teamname);
              localStorage.setItem("teamimage", result.teamimage);
              localStorage.setItem("userid", result.userid);
              localStorage.setItem("status", result.status);

              var role = localStorage.getItem("role");
              var status = localStorage.getItem("status");

              if (status == 1) {
                if (role == 1) {
                  location.href = "Adminhome.html";
                } else {
                  location.href = "Home.html";
                }
              } else {
                alert("You've been banned!");
              }
            },
            error: function () {
              alert("Login Failed");
            },
          });

          return false;
        });
        $("#signup_form").submit(function (e) {
          e.preventDefault();

          var password = $("#signup_password").val();
          var confirmpassword = $("#confirmpassword").val();

          if (password == confirmpassword) {
            var formData = new FormData(signup_form);
            formData.append("create", "true");
            formData.delete("confirmpassword");

            $.ajax({
              url: "../users.php",
              type: "POST",
              data: formData,
              contentType: false,
              processData: false,
              success: function () {
                window.location.href = "Welcome.html";
                alert("Sign Up Successful.Please login to continue");
              },
              error: function () {
                alert("Sign Up Failed");
              },
            });
            return false;
          } else {
            alert("Passwords did not match");
          }
        });
      });
    </script>
  </body>
</html>
